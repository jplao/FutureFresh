<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Future Fresh - Youth Breaking Jam</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Permanent+Marker&family=Rubik:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --electric-blue: #00d9ff;
            --flame-orange: #ff6b00;
            --gold: #ffd700;
            --neon-green: #39ff14;
            --deep-purple: #1a0033;
            --brick-red: #8b1e1e;
            --shadow: rgba(0, 0, 0, 0.8);
        }

        body {
            font-family: 'Rubik', sans-serif;
            background: linear-gradient(135deg, #0a0015 0%, #1a0033 50%, #0f001f 100%);
            color: white;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(255, 107, 0, 0.03) 2px, rgba(255, 107, 0, 0.03) 4px),
                radial-gradient(circle at 20% 30%, rgba(0, 217, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(255, 215, 0, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .grain {
            position: fixed;
            top: -50%;
            left: -50%;
            right: -50%;
            bottom: -50%;
            width: 200%;
            height: 200%;
            background: url('data:image/svg+xml;utf8,<svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"><filter id="noiseFilter"><feTurbulence type="fractalNoise" baseFrequency="3" numOctaves="4" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23noiseFilter)" opacity="0.05"/></svg>');
            opacity: 0.4;
            pointer-events: none;
            animation: grain 8s steps(10) infinite;
            z-index: 1;
        }

        @keyframes grain {
            0%, 100% { transform: translate(0, 0); }
            10% { transform: translate(-5%, -5%); }
            20% { transform: translate(-10%, 5%); }
            30% { transform: translate(5%, -10%); }
            40% { transform: translate(-5%, 15%); }
            50% { transform: translate(-10%, 5%); }
            60% { transform: translate(15%, 0); }
            70% { transform: translate(0, 10%); }
            80% { transform: translate(-15%, 0); }
            90% { transform: translate(10%, 5%); }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 2;
        }

        .header {
            text-align: center;
            padding: 3rem 0;
            position: relative;
        }

        .logo {
            font-family: 'Permanent Marker', cursive;
            font-size: 5rem;
            background: linear-gradient(45deg, var(--gold), var(--flame-orange), var(--electric-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 40px rgba(255, 215, 0, 0.5);
            letter-spacing: 0.1em;
            transform: rotate(-2deg);
            margin-bottom: 1rem;
            animation: pulse 3s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: rotate(-2deg) scale(1); }
            50% { transform: rotate(-2deg) scale(1.05); }
        }

        .tagline {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            color: var(--electric-blue);
            letter-spacing: 0.2em;
            text-transform: uppercase;
        }

        .admin-badge {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--gold), var(--flame-orange));
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1rem;
            letter-spacing: 0.1em;
            z-index: 1000;
            display: none;
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.4);
        }

        .admin-badge.show {
            display: block;
        }

        .logout-btn {
            background: rgba(0, 0, 0, 0.3);
            border: none;
            color: white;
            padding: 0.3rem 0.8rem;
            margin-left: 1rem;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 0.9rem;
        }

        .logout-btn:hover {
            background: rgba(0, 0, 0, 0.6);
        }

        .nav-tabs {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .nav-tab {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.3rem;
            padding: 1rem 2.5rem;
            background: linear-gradient(135deg, rgba(255, 107, 0, 0.2), rgba(0, 217, 255, 0.2));
            border: 3px solid var(--electric-blue);
            color: white;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        .nav-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.3), transparent);
            transition: left 0.5s;
        }

        .nav-tab:hover::before {
            left: 100%;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, var(--flame-orange), var(--electric-blue));
            border-color: var(--gold);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
            transform: translateY(-3px);
        }

        .nav-tab.admin-only {
            border-color: var(--gold);
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 107, 0, 0.2));
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .event-info {
            background: linear-gradient(135deg, rgba(139, 30, 30, 0.3), rgba(26, 0, 51, 0.3));
            border: 2px solid var(--flame-orange);
            border-radius: 20px;
            padding: 3rem;
            margin: 2rem 0;
            box-shadow: 0 10px 50px var(--shadow);
            position: relative;
        }

        .event-info::before {
            content: 'üî•';
            position: absolute;
            top: -20px;
            right: 30px;
            font-size: 3rem;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .info-item {
            background: rgba(0, 0, 0, 0.4);
            padding: 1.5rem;
            border-radius: 10px;
            border-left: 4px solid var(--gold);
        }

        .info-label {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            color: var(--electric-blue);
            margin-bottom: 0.5rem;
            letter-spacing: 0.1em;
        }

        .info-value {
            font-size: 1.1rem;
            font-weight: 500;
        }

        .form-section {
            background: linear-gradient(135deg, rgba(0, 217, 255, 0.1), rgba(255, 107, 0, 0.1));
            border: 2px solid var(--electric-blue);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.2rem;
            color: var(--gold);
            margin-bottom: 0.5rem;
            letter-spacing: 0.05em;
        }

        input, select {
            width: 100%;
            padding: 1rem;
            font-size: 1rem;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid var(--electric-blue);
            border-radius: 8px;
            color: white;
            font-family: 'Rubik', sans-serif;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }

        .btn {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5rem;
            padding: 1.2rem 3rem;
            background: linear-gradient(135deg, var(--flame-orange), var(--gold));
            border: 3px solid var(--gold);
            color: white;
            cursor: pointer;
            border-radius: 10px;
            letter-spacing: 0.1em;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 40px rgba(255, 215, 0, 0.5);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--electric-blue), var(--deep-purple));
            border-color: var(--electric-blue);
        }

        .dancers-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .dancer-card {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.6), rgba(26, 0, 51, 0.4));
            border: 2px solid var(--electric-blue);
            border-radius: 15px;
            padding: 1.5rem;
            position: relative;
            transition: all 0.3s ease;
        }

        .dancer-card:hover {
            transform: translateY(-5px);
            border-color: var(--gold);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
        }

        .dancer-name {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.8rem;
            color: var(--gold);
            margin-bottom: 0.5rem;
        }

        .dancer-info {
            font-size: 0.95rem;
            color: var(--electric-blue);
            margin: 0.3rem 0;
        }

        .checked-in {
            display: inline-block;
            background: var(--neon-green);
            color: black;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 700;
            margin-top: 0.5rem;
        }

        .not-checked-in {
            display: inline-block;
            background: rgba(255, 107, 0, 0.3);
            color: var(--flame-orange);
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 700;
            margin-top: 0.5rem;
        }

        .bracket-container {
            margin: 2rem 0;
            overflow-x: auto;
            padding: 2rem 0;
        }

        .round-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            color: var(--gold);
            margin-bottom: 1rem;
            letter-spacing: 0.1em;
        }

        .matchups {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .matchup {
            background: linear-gradient(135deg, rgba(255, 107, 0, 0.2), rgba(0, 217, 255, 0.2));
            border: 2px solid var(--electric-blue);
            border-radius: 10px;
            padding: 1rem;
            min-width: 300px;
        }

        .matchup-header {
            font-family: 'Bebas Neue', sans-serif;
            color: var(--gold);
            margin-bottom: 0.8rem;
            font-size: 1.2rem;
        }

        .competitor {
            background: rgba(0, 0, 0, 0.5);
            padding: 0.8rem;
            margin: 0.5rem 0;
            border-radius: 5px;
            border-left: 3px solid var(--electric-blue);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .competitor.winner {
            border-left-color: var(--gold);
            background: rgba(255, 215, 0, 0.2);
            font-weight: 700;
        }

        .select-winner {
            background: var(--flame-orange);
            color: white;
            border: none;
            padding: 0.4rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 0.9rem;
            letter-spacing: 0.05em;
        }

        .select-winner:hover {
            background: var(--gold);
            color: black;
        }

        .champion-banner {
            text-align: center;
            padding: 3rem;
            background: linear-gradient(135deg, var(--gold), var(--flame-orange));
            border-radius: 20px;
            margin: 2rem 0;
            position: relative;
            overflow: hidden;
        }

        .champion-banner::before {
            content: 'üèÜ';
            position: absolute;
            font-size: 8rem;
            opacity: 0.1;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .champion-banner h2 {
            font-family: 'Permanent Marker', cursive;
            font-size: 3rem;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }

        .champion-banner p {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            position: relative;
            z-index: 1;
        }

        .age-bracket-selector {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin: 2rem 0;
            justify-content: center;
        }

        .bracket-btn {
            font-family: 'Bebas Neue', sans-serif;
            padding: 0.8rem 1.5rem;
            background: rgba(0, 217, 255, 0.2);
            border: 2px solid var(--electric-blue);
            color: white;
            cursor: pointer;
            border-radius: 8px;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .bracket-btn.active {
            background: var(--gold);
            color: black;
            border-color: var(--gold);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255, 107, 0, 0.2), rgba(0, 0, 0, 0.4));
            border: 2px solid var(--flame-orange);
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
        }

        .stat-number {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 3rem;
            color: var(--gold);
        }

        .stat-label {
            font-size: 1rem;
            color: var(--electric-blue);
            margin-top: 0.5rem;
        }

        .login-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            display: none;
        }

        .login-modal.show {
            display: flex;
        }

        .login-box {
            background: linear-gradient(135deg, rgba(26, 0, 51, 0.95), rgba(10, 0, 21, 0.95));
            border: 3px solid var(--gold);
            border-radius: 20px;
            padding: 3rem;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(255, 215, 0, 0.3);
        }

        .login-box h2 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2.5rem;
            color: var(--gold);
            margin-bottom: 2rem;
            text-align: center;
            letter-spacing: 0.1em;
        }

        .sync-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid var(--electric-blue);
            padding: 1rem 1.5rem;
            border-radius: 10px;
            color: white;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1rem;
            z-index: 1000;
            display: none;
        }

        .sync-status.show {
            display: block;
        }

        .sync-status.error {
            border-color: var(--flame-orange);
        }

        @media (max-width: 768px) {
            .logo {
                font-size: 3rem;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .nav-tab {
                width: 100%;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            .dancers-list {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="grain"></div>
    
    <!-- Admin Badge -->
    <div class="admin-badge" id="adminBadge">
        üëë Admin Mode
        <button class="logout-btn" onclick="logout()">Logout</button>
    </div>

    <!-- Sync Status -->
    <div class="sync-status" id="syncStatus"></div>

    <!-- Login Modal -->
    <div class="login-modal" id="loginModal">
        <div class="login-box">
            <h2>üîê Admin Login</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="adminPassword">Admin Password</label>
                    <input type="password" id="adminPassword" required placeholder="Enter admin password">
                </div>
                <button type="submit" class="btn" style="width: 100%; margin-top: 1rem;">Login</button>
                <button type="button" class="btn btn-secondary" style="width: 100%; margin-top: 1rem;" onclick="closeLoginModal()">
                    Continue as Viewer
                </button>
            </form>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <div class="logo">FUTURE FRESH</div>
            <div class="tagline">Youth Breaking Jam</div>
        </div>

        <!-- Manual Refresh Button for Public Users -->
        <button class="btn btn-secondary" id="manualRefreshBtn" style="
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 0.6rem 1.2rem;
            font-size: 0.9rem;
            z-index: 999;
        " onclick="alert('‚úÖ Real-time sync active! Data updates automatically.')">
            üîÑ Real-Time Sync
        </button>

        <!-- Admin Login Button - Top Left Corner -->
        <button class="btn btn-secondary" id="adminLoginBtn" style="
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 0.6rem 1.2rem;
            font-size: 0.9rem;
            z-index: 1000;
            display: none;
        " onclick="document.getElementById('loginModal').classList.add('show')">
            üîê Admin
        </button>

        <script>
            // Show/hide admin login button based on login state
            function updateLoginButton() {
                const loginBtn = document.getElementById('adminLoginBtn');
                if (loginBtn) {
                    loginBtn.style.display = sessionStorage.getItem('isAdmin') === 'true' ? 'none' : 'block';
                }
            }
        </script>

        <div class="nav-tabs">
            <button class="nav-tab active" data-tab="home">Event Info</button>
            <button class="nav-tab" data-tab="register">Register</button>
            <button class="nav-tab admin-only" data-tab="checkin" style="display: none;">Admin: Check-In</button>
            <button class="nav-tab" data-tab="brackets">Brackets</button>
            <button class="nav-tab admin-only" data-tab="manage-brackets" style="display: none;">Admin: Manage Brackets</button>
            <button class="nav-tab admin-only" data-tab="dashboard" style="display: none;">Admin: Dashboard</button>
        </div>

        <!-- Home Tab -->
        <div class="tab-content active" id="home">
            <div class="event-info">
                <h2 style="font-family: 'Bebas Neue', sans-serif; font-size: 2.5rem; color: var(--gold); margin-bottom: 2rem; letter-spacing: 0.1em;">EVENT DETAILS</h2>
                
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">üìÖ Date</div>
                        <div class="info-value">March 22nd, 2026</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">‚è∞ Time</div>
                        <div class="info-value">12:00 PM - 6:00 PM</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">üìç Location</div>
                        <div class="info-value">BBoy Factory<br>6401 N. Broadway<br>Denver, CO 80216</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">üí∞ Registration</div>
                        <div class="info-value">$15 - Dancers<br>$5 - Spectators</div>
                    </div>
                </div>

                <h3 style="font-family: 'Bebas Neue', sans-serif; font-size: 2rem; color: var(--electric-blue); margin: 3rem 0 1rem; letter-spacing: 0.1em;">Age Divisions</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">üî• Division 1</div>
                        <div class="info-value">Ages 6-8</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">üî• Division 2</div>
                        <div class="info-value">Ages 9-11</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">üî• Division 3</div>
                        <div class="info-value">Ages 12-14</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">üî• Division 4</div>
                        <div class="info-value">Ages 15-18</div>
                    </div>
                </div>

                <h3 style="font-family: 'Bebas Neue', sans-serif; font-size: 2rem; color: var(--electric-blue); margin: 3rem 0 1rem; letter-spacing: 0.1em;">Event Features</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">üé§ Open Cyphers</div>
                        <div class="info-value">Free-style sessions</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">üéß DJ Spinning Breakbeats</div>
                        <div class="info-value">Live music all day</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">üë®‚Äç‚öñÔ∏è Knowledgeable Judges</div>
                        <div class="info-value">Expert evaluation</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">üåü Community Atmosphere</div>
                        <div class="info-value">Positive vibes only</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Register Tab -->
        <div class="tab-content" id="register">
            <div class="form-section">
                <h2 style="font-family: 'Bebas Neue', sans-serif; font-size: 2.5rem; color: var(--gold); margin-bottom: 2rem; letter-spacing: 0.1em;">Dancer Registration</h2>
                
                <form id="registrationForm">
                    <div class="form-group">
                        <label for="dancerName">Dancer Name / B-Boy/B-Girl Name</label>
                        <input type="text" id="dancerName" required>
                    </div>

                    <div class="form-group">
                        <label for="age">Age</label>
                        <input type="number" id="age" min="6" max="18" required>
                    </div>

                    <div class="form-group">
                        <label for="ageBracket">Age Bracket (Auto-Selected)</label>
                        <select id="ageBracket" disabled>
                            <option value="">Select age first</option>
                            <option value="6-8">6-8 Years</option>
                            <option value="9-11">9-11 Years</option>
                            <option value="12-14">12-14 Years</option>
                            <option value="15-18">15-18 Years</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="email">Email (Optional)</label>
                        <input type="email" id="email">
                    </div>

                    <!-- Admin-only fields -->
                    <div id="adminRegistrationFields" style="display: none;">
                        <div style="background: rgba(255, 215, 0, 0.1); border: 2px solid var(--gold); border-radius: 10px; padding: 1.5rem; margin-top: 1rem;">
                            <h3 style="font-family: 'Bebas Neue', sans-serif; font-size: 1.5rem; color: var(--gold); margin-bottom: 1rem; letter-spacing: 0.1em;">üëë Admin Quick Actions</h3>
                            
                            <div style="display: flex; gap: 2rem; flex-wrap: wrap;">
                                <label style="display: flex; align-items: center; cursor: pointer; font-size: 1.1rem;">
                                    <input type="checkbox" id="quickCheckin" style="width: auto; margin-right: 0.8rem; transform: scale(1.5);">
                                    <span>‚úÖ Check In Immediately</span>
                                </label>
                                
                                <label style="display: flex; align-items: center; cursor: pointer; font-size: 1.1rem;">
                                    <input type="checkbox" id="quickPaid" style="width: auto; margin-right: 0.8rem; transform: scale(1.5);">
                                    <span>üí∞ Mark as Paid</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn" style="width: 100%; margin-top: 1rem;">Register Dancer</button>
                </form>
            </div>
        </div>

        <!-- Check-In Tab (Admin Only) -->
        <div class="tab-content" id="checkin">
            <div class="form-section">
                <h2 style="font-family: 'Bebas Neue', sans-serif; font-size: 2.5rem; color: var(--gold); margin-bottom: 2rem; letter-spacing: 0.1em;">Check-In Dancers</h2>
                
                <div style="margin-bottom: 2rem;">
                    <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                        <button class="btn" style="padding: 0.8rem 1.5rem; font-size: 1.1rem;" onclick="alert('‚úÖ Real-time sync active! Data updates automatically.')">
                            üîÑ Real-Time Sync
                        </button>
                    </div>
                    <div class="form-group">
                        <label for="searchDancers">Search Dancers</label>
                        <input type="text" id="searchDancers" placeholder="Search by name..." oninput="updateCheckinList()">
                    </div>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem;">
                        <button class="bracket-btn active" onclick="filterCheckin('all')">All</button>
                        <button class="bracket-btn" onclick="filterCheckin('checked-in')">Checked In</button>
                        <button class="bracket-btn" onclick="filterCheckin('not-checked-in')">Not Checked In</button>
                        <button class="bracket-btn" onclick="filterCheckin('paid')">Paid</button>
                        <button class="bracket-btn" onclick="filterCheckin('unpaid')">Unpaid</button>
                    </div>
                </div>

                <div id="checkinList" class="dancers-list">
                    <!-- Dancers will be populated here -->
                </div>
            </div>
        </div>

        <!-- Brackets Tab (Public View) -->
        <div class="tab-content" id="brackets">
            <div class="form-section">
                <h2 style="font-family: 'Bebas Neue', sans-serif; font-size: 2.5rem; color: var(--gold); margin-bottom: 1rem; letter-spacing: 0.1em; text-align: center;">Tournament Brackets</h2>
                
                <div class="age-bracket-selector" id="publicBracketSelector">
                    <!-- Bracket buttons will be populated here -->
                </div>

                <div id="publicBracketDisplay">
                    <!-- Brackets will be displayed here -->
                </div>
            </div>
        </div>

        <!-- Manage Brackets Tab (Admin Only) -->
        <div class="tab-content" id="manage-brackets">
            <div class="form-section">
                <h2 style="font-family: 'Bebas Neue', sans-serif; font-size: 2.5rem; color: var(--gold); margin-bottom: 1rem; letter-spacing: 0.1em; text-align: center;">Manage Tournament Brackets</h2>
                
                <div style="text-align: center; margin-bottom: 2rem; display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                    <button class="btn" id="generateBracketsBtn">Generate All Brackets</button>
                    <button class="btn" style="background: linear-gradient(135deg, #e74c3c, #c0392b); border-color: #e74c3c;" onclick="resetAllBrackets()">
                        üóëÔ∏è Reset ALL Brackets
                    </button>
                </div>

                <div class="age-bracket-selector" id="bracketSelector">
                    <!-- Bracket buttons will be populated here -->
                </div>

                <!-- Manual Dancer Entry -->
                <div id="manualEntrySection" style="display: none; background: rgba(255, 215, 0, 0.1); border: 2px solid var(--gold); border-radius: 15px; padding: 2rem; margin: 2rem 0;">
                    <h3 style="font-family: 'Bebas Neue', sans-serif; font-size: 2rem; color: var(--gold); margin-bottom: 1rem; letter-spacing: 0.1em;">‚úèÔ∏è Manually Add/Replace Dancer</h3>
                    <p style="margin-bottom: 1rem; color: var(--electric-blue);">Use this to add a new dancer to a specific match or replace a competitor who dropped out.</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-top: 1rem;">
                        <div class="form-group">
                            <label>Select Age Bracket</label>
                            <select id="manualBracketSelect" onchange="updateManualRoundSelect()">
                                <option value="">Choose bracket...</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Select Round</label>
                            <select id="manualRoundSelect" onchange="updateManualMatchSelect()">
                                <option value="">Choose round...</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Select Match</label>
                            <select id="manualMatchSelect">
                                <option value="">Choose match...</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Position</label>
                            <select id="manualPosition">
                                <option value="1">Competitor 1 (Top)</option>
                                <option value="2">Competitor 2 (Bottom)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-top: 1rem;">
                        <label>Dancer Name</label>
                        <input type="text" id="manualDancerName" placeholder="Enter dancer name...">
                    </div>
                    
                    <div style="display: flex; gap: 1rem; margin-top: 1rem; flex-wrap: wrap;">
                        <button class="btn" onclick="addManualDancer()">‚úÖ Add/Replace Dancer</button>
                        <button class="btn btn-secondary" onclick="toggleManualEntry()">‚ùå Cancel</button>
                    </div>
                </div>

                <div style="text-align: center; margin: 1rem 0;">
                    <button class="btn btn-secondary" id="toggleManualEntryBtn" style="padding: 0.8rem 1.5rem; font-size: 1rem; display: none;" onclick="toggleManualEntry()">
                        ‚úèÔ∏è Manually Add/Replace Dancer
                    </button>
                </div>

                <div id="bracketDisplay">
                    <!-- Brackets will be displayed here -->
                </div>
            </div>
        </div>

        <!-- Dashboard Tab (Admin Only) -->
        <div class="tab-content" id="dashboard">
            <div class="form-section">
                <h2 style="font-family: 'Bebas Neue', sans-serif; font-size: 2.5rem; color: var(--gold); margin-bottom: 2rem; letter-spacing: 0.1em; text-align: center;">Event Dashboard</h2>
                
                <div class="stats-grid" id="statsGrid">
                    <!-- Stats will be populated here -->
                </div>

                <!-- Setup Instructions for Admins -->
                <div style="background: rgba(255, 215, 0, 0.1); border: 2px solid var(--gold); border-radius: 15px; padding: 2rem; margin: 3rem 0;">
                    <h3 style="font-family: 'Bebas Neue', sans-serif; font-size: 2rem; color: var(--gold); margin-bottom: 1rem; letter-spacing: 0.1em;">üìä Database Setup Instructions</h3>
                    <p style="margin-bottom: 1rem; line-height: 1.6;">This site uses SheetDB to connect to Google Sheets as a database.</p>
                    
                    <div style="background: rgba(0, 0, 0, 0.4); padding: 1.5rem; border-radius: 10px; margin-top: 1rem;">
                        <p style="font-weight: 700; color: var(--electric-blue); margin-bottom: 1rem;">Setup Steps (5 minutes):</p>
                        <ol style="line-height: 2; margin-left: 1.5rem;">
                            <li>Create a Google Sheet with columns: <code style="background: rgba(0, 217, 255, 0.2); padding: 0.2rem 0.5rem; border-radius: 3px;">id, name, age, ageBracket, email, type, checkedIn, paid, registrationTime</code></li>
                            <li>Go to <a href="https://sheetdb.io/" target="_blank" style="color: var(--gold); text-decoration: underline;">SheetDB.io</a> (FREE account)</li>
                            <li>Click "Create API" and paste your Google Sheet link</li>
                            <li>Copy your SheetDB API URL</li>
                            <li>Edit the HTML file - replace <code style="background: rgba(0, 217, 255, 0.2); padding: 0.2rem 0.5rem; border-radius: 3px;">SHEETDB_API_URL</code></li>
                            <li>Set <code style="background: rgba(0, 217, 255, 0.2); padding: 0.2rem 0.5rem; border-radius: 3px;">ADMIN_PASSWORD</code> to your desired password</li>
                        </ol>
                        <p style="margin-top: 1rem; font-style: italic; color: var(--neon-green);">‚ú® FREE plan: 1000 API calls/month</p>
                        <p style="margin-top: 0.5rem; font-style: italic; color: var(--electric-blue);">üí° All data stored in your own Google Sheet!</p>
                    </div>
                </div>

                <h3 style="font-family: 'Bebas Neue', sans-serif; font-size: 2rem; color: var(--electric-blue); margin: 3rem 0 1rem; letter-spacing: 0.1em; text-align: center;">All Registered Dancers</h3>
                <div id="allDancersList" class="dancers-list">
                    <!-- All dancers will be listed here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->

    <script>
        // ====================================
        // FIREBASE CONFIGURATION (Real-time sync)
        // Replace this with your Firebase config from Firebase Console
        // ====================================
        const firebaseConfig = {
            apiKey: "AIzaSyAOaANElWXoUoSzgHxffRTBskpO-3sAS3w",
            authDomain: "futurefresh-11633.firebaseapp.com",
            databaseURL: "https://futurefresh-11633-default-rtdb.firebaseio.com",
            projectId: "futurefresh-11633",
            storageBucket: "futurefresh-11633.firebasestorage.app",
            messagingSenderId: "798099557890",
            appId: "1:798099557890:web:757ef6d80984f4faa4611b"
        };

        // ====================================
        // GOOGLE SHEETS BACKUP (For viewing/printing dancers only)
        // ====================================
        const SHEETDB_API_URL = "https://sheetdb.io/api/v1/9g0rijmyv6e77"; // Your dancers sheet
        // Note: Brackets only saved to Firebase (real-time only, no backup needed)

        // ====================================
        // ADMIN PASSWORD
        // ====================================
        const ADMIN_PASSWORD = "futurefresh2026";

        // Initialize Firebase
        let database;
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            console.log('‚úÖ Firebase initialized successfully');
        } catch (error) {
            console.error("Firebase initialization error:", error);
            alert("‚ö†Ô∏è Firebase not configured. Please set up your Firebase config in the HTML file.");
        }

        // Admin state
        let isAdmin = sessionStorage.getItem('isAdmin') === 'true';
        let checkinFilter = 'all';

        // Data - Firebase uses objects, not arrays
        let dancers = {};
        let brackets = {};

        // Firebase real-time listeners - automatically sync across all devices!
        if (database) {
            database.ref('dancers').on('value', (snapshot) => {
                const firebaseData = snapshot.val() || {};
                dancers = firebaseData;
                console.log('‚úÖ Dancers updated from Firebase:', dancers);
                updateAllViews();
            });

            database.ref('brackets').on('value', (snapshot) => {
                const firebaseData = snapshot.val() || {};
                brackets = firebaseData;
                console.log('‚úÖ Brackets updated from Firebase:', brackets);
                displayPublicBracketSelector();
                if (isAdmin) {
                    displayBracketSelector();
                }
            });
        }

        function updateAllViews() {
            updateCheckinList();
            if (isAdmin) {
                updateDashboard();
                displayBracketSelector();
            }
            displayPublicBracketSelector();
        }

        // Save dancer to BOTH Firebase and Google Sheets
        async function saveDancer(dancer) {
            try {
                // 1. Save to Firebase (real-time sync)
                if (database) {
                    await database.ref('dancers/' + dancer.id).set(dancer);
                    console.log('‚úÖ Saved to Firebase:', dancer.name);
                }

                // 2. Backup to Google Sheets (for viewing/printing)
                try {
                    await fetch(SHEETDB_API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(dancer)
                    });
                    console.log('‚úÖ Backed up to Google Sheets:', dancer.name);
                } catch (sheetError) {
                    console.warn('‚ö†Ô∏è Google Sheets backup failed (Firebase saved successfully):', sheetError);
                }

                showSyncStatus('‚úÖ Dancer saved!');
            } catch (error) {
                console.error('‚ùå Save error:', error);
                showSyncStatus('‚ùå Failed to save dancer', true);
                throw error;
            }
        }

        // Update dancer in BOTH Firebase and Google Sheets
        async function updateDancer(id, updates) {
            try {
                showSyncStatus('‚òÅÔ∏è Updating...');
                console.log('Update requested - ID:', id, 'Updates:', updates);
                
                // Find the dancer in Firebase data
                const dancer = dancers[id];
                if (!dancer) {
                    throw new Error('Dancer not found');
                }
                
                console.log('Original dancer data:', dancer);
                
                // Create updated dancer object - preserve ALL fields
                const updatedDancer = {
                    id: dancer.id,
                    name: dancer.name,
                    age: dancer.age,
                    ageBracket: dancer.ageBracket,
                    email: dancer.email || '',
                    type: dancer.type,
                    checkedIn: dancer.checkedIn,
                    paid: dancer.paid,
                    registrationTime: dancer.registrationTime,
                    // Apply updates
                    ...updates
                };
                
                console.log('Updated dancer data:', updatedDancer);
                
                // 1. Update in Firebase (real-time sync)
                if (database) {
                    await database.ref('dancers/' + id).update(updates);
                    console.log('‚úÖ Updated in Firebase');
                }
                
                // 2. Update in Google Sheets (backup)
                try {
                    // Delete old row
                    await fetch(`${SHEETDB_API_URL}/id/${id}`, {
                        method: 'DELETE'
                    });
                    
                    // Add updated row
                    await fetch(SHEETDB_API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(updatedDancer)
                    });
                    console.log('‚úÖ Updated in Google Sheets');
                } catch (sheetError) {
                    console.warn('‚ö†Ô∏è Google Sheets update failed (Firebase updated successfully)');
                }
                
                showSyncStatus('‚úÖ Updated successfully!');
            } catch (error) {
                console.error('Update error:', error);
                showSyncStatus('‚ùå Update failed', true);
                alert('Update failed. Please try again or check your internet connection.');
            }
        }

        // Delete dancer from BOTH Firebase and Google Sheets
        async function deleteDancer(id, name) {
            if (!isAdmin) return alert('Admin access required');
            
            if (!confirm(`‚ö†Ô∏è Are you sure you want to delete ${name}?\n\nThis action cannot be undone!`)) return;
            
            try {
                // 1. Delete from Firebase
                if (database) {
                    await database.ref('dancers/' + id).remove();
                    console.log('‚úÖ Deleted from Firebase');
                }
                
                // 2. Delete from Google Sheets
                try {
                    await fetch(`${SHEETDB_API_URL}/id/${id}`, {
                        method: 'DELETE'
                    });
                    console.log('‚úÖ Deleted from Google Sheets');
                } catch (sheetError) {
                    console.warn('‚ö†Ô∏è Google Sheets delete failed (Firebase deleted successfully)');
                }
                
                showSyncStatus('üóëÔ∏è Registration deleted!');
            } catch (error) {
                console.error('Delete error:', error);
                showSyncStatus('‚ùå Failed to delete', true);
            }
        }

        // Save brackets to Firebase only (no Google Sheets backup needed)
        async function saveBrackets() {
            try {
                showSyncStatus('‚òÅÔ∏è Saving brackets...');
                console.log('Saving brackets to Firebase:', brackets);
                
                // Save to Firebase (real-time sync)
                if (database) {
                    await database.ref('brackets').set(brackets);
                    console.log('‚úÖ Brackets saved to Firebase');
                    showSyncStatus('‚úÖ Brackets saved!');
                } else {
                    throw new Error('Firebase not initialized');
                }
            } catch (error) {
                console.error('Error saving brackets:', error);
                showSyncStatus('‚ùå Failed to save brackets', true);
            }
        }

        // Show sync status
        function showSyncStatus(message, isError = false) {
            const status = document.getElementById('syncStatus');
            status.textContent = message;
            status.classList.toggle('error', isError);
            status.classList.add('show');
            setTimeout(() => status.classList.remove('show'), 3000);
        }

        // Initialize UI based on admin status
        function updateUIForAdminStatus() {
            const adminTabs = document.querySelectorAll('.nav-tab.admin-only');
            const adminBadge = document.getElementById('adminBadge');
            const adminRegFields = document.getElementById('adminRegistrationFields');
            
            if (isAdmin) {
                adminTabs.forEach(tab => tab.style.display = 'block');
                adminBadge.classList.add('show');
                if (adminRegFields) adminRegFields.style.display = 'block';
            } else {
                adminTabs.forEach(tab => tab.style.display = 'none');
                adminBadge.classList.remove('show');
                if (adminRegFields) adminRegFields.style.display = 'none';
            }
        }

        // Login functionality
        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const password = document.getElementById('adminPassword').value;
            
            if (password === ADMIN_PASSWORD) {
                isAdmin = true;
                sessionStorage.setItem('isAdmin', 'true');
                updateUIForAdminStatus();
                updateLoginButton();
                closeLoginModal();
                showSyncStatus('‚úÖ Admin login successful!');
            } else {
                alert('‚ùå Incorrect password');
                document.getElementById('adminPassword').value = '';
            }
        });

        function closeLoginModal() {
            document.getElementById('loginModal').classList.remove('show');
        }

        function logout() {
            isAdmin = false;
            sessionStorage.removeItem('isAdmin');
            updateUIForAdminStatus();
            updateLoginButton();
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelector('[data-tab="home"]').classList.add('active');
            document.getElementById('home').classList.add('active');
            showSyncStatus('Logged out');
        }

        // Load data from Google Sheets

        // Save brackets to Firebase only (no Google Sheets backup needed)

        // Manual refresh only - use the üîÑ Refresh button in top-right corner
        // No auto-refresh to avoid unnecessary API calls and rate limits

        // Tab Navigation
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const targetTab = tab.dataset.tab;
                
                if (tab.classList.contains('admin-only') && !isAdmin) {
                    document.getElementById('loginModal').classList.add('show');
                    return;
                }
                
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(targetTab).classList.add('active');
                
                if (targetTab === 'checkin') updateCheckinList();
                if (targetTab === 'dashboard') updateDashboard();
                if (targetTab === 'manage-brackets') displayBracketSelector();
                if (targetTab === 'brackets') displayPublicBracketSelector();
            });
        });

        // Auto-select age bracket
        document.getElementById('age').addEventListener('input', (e) => {
            const age = parseInt(e.target.value);
            const bracketSelect = document.getElementById('ageBracket');
            
            if (age >= 6 && age <= 8) bracketSelect.value = '6-8';
            else if (age >= 9 && age <= 11) bracketSelect.value = '9-11';
            else if (age >= 12 && age <= 14) bracketSelect.value = '12-14';
            else if (age >= 15 && age <= 18) bracketSelect.value = '15-18';
            else bracketSelect.value = '';
        });

        // Registration Form
        document.getElementById('registrationForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const dancer = {
                id: Date.now().toString(),
                name: document.getElementById('dancerName').value,
                age: parseInt(document.getElementById('age').value),
                ageBracket: document.getElementById('ageBracket').value,
                email: document.getElementById('email').value,
                type: 'participant', // All registrations are dancers
                checkedIn: isAdmin && document.getElementById('quickCheckin')?.checked || false,
                paid: isAdmin && document.getElementById('quickPaid')?.checked || false,
                registrationTime: new Date().toISOString()
            };
            
            try {
                showSyncStatus('‚òÅÔ∏è Registering...');
                await saveDancer(dancer);
                
                let message = `‚úÖ ${dancer.name} registered successfully in the ${dancer.ageBracket} age bracket!`;
                if (dancer.checkedIn) message += '\n‚úÖ Checked in!';
                if (dancer.paid) message += '\nüí∞ Marked as paid!';
                alert(message);
                e.target.reset();
            } catch (error) {
                console.error('Registration error:', error);
                showSyncStatus('‚ùå Registration failed', true);
                alert('Registration failed. Please try again.');
            }
        });

        // Check-in List
        function updateCheckinList() {
            const checkinList = document.getElementById('checkinList');
            // Convert Firebase object to array
            let participants = Object.values(dancers).filter(d => d.type === 'participant');
            
            const searchTerm = document.getElementById('searchDancers')?.value.toLowerCase() || '';
            if (searchTerm) {
                participants = participants.filter(d => 
                    d.name.toLowerCase().includes(searchTerm) ||
                    (d.email && d.email.toLowerCase().includes(searchTerm))
                );
            }
            
            if (checkinFilter === 'checked-in') {
                participants = participants.filter(d => d.checkedIn);
            } else if (checkinFilter === 'not-checked-in') {
                participants = participants.filter(d => !d.checkedIn);
            } else if (checkinFilter === 'paid') {
                participants = participants.filter(d => d.paid);
            } else if (checkinFilter === 'unpaid') {
                participants = participants.filter(d => !d.paid);
            }
            
            if (participants.length === 0) {
                checkinList.innerHTML = '<p style="text-align: center; color: var(--electric-blue); font-size: 1.2rem;">No dancers match your filters.</p>';
                return;
            }
            
            checkinList.innerHTML = participants.map(dancer => `
                <div class="dancer-card">
                    <div class="dancer-name">${dancer.name}</div>
                    <div class="dancer-info">Age: ${dancer.age}</div>
                    <div class="dancer-info">Bracket: ${dancer.ageBracket}</div>
                    <div class="dancer-info">Email: ${dancer.email || 'N/A'}</div>
                    <div style="margin-top: 0.8rem;">
                        <span class="${dancer.checkedIn ? 'checked-in' : 'not-checked-in'}">
                            ${dancer.checkedIn ? '‚úì Checked In' : 'Not Checked In'}
                        </span>
                        <span class="${dancer.paid ? 'checked-in' : 'not-checked-in'}" style="margin-left: 0.5rem;">
                            ${dancer.paid ? 'üí∞ Paid' : 'üí≥ Unpaid'}
                        </span>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-top: 1rem;">
                        ${!dancer.checkedIn ? `
                            <button class="btn btn-secondary" style="padding: 0.8rem; font-size: 1rem;" onclick="checkInDancer('${dancer.id}')">
                                Check In
                            </button>
                        ` : `
                            <button class="btn" style="padding: 0.8rem; font-size: 1rem; background: linear-gradient(135deg, #666, #999);" onclick="uncheckInDancer('${dancer.id}')">
                                Undo Check-In
                            </button>
                        `}
                        ${!dancer.paid ? `
                            <button class="btn" style="padding: 0.8rem; font-size: 1rem; background: linear-gradient(135deg, var(--neon-green), #2ecc71);" onclick="markAsPaid('${dancer.id}')">
                                Mark Paid
                            </button>
                        ` : `
                            <button class="btn" style="padding: 0.8rem; font-size: 1rem; background: linear-gradient(135deg, #666, #999);" onclick="markAsUnpaid('${dancer.id}')">
                                Mark Unpaid
                            </button>
                        `}
                    </div>
                    <button class="btn" style="width: 100%; margin-top: 0.5rem; padding: 0.8rem; font-size: 1rem; background: linear-gradient(135deg, #e74c3c, #c0392b); border-color: #e74c3c;" onclick="deleteDancer('${dancer.id}', '${dancer.name}')">
                        üóëÔ∏è Delete Registration
                    </button>
                </div>
            `).join('');
        }

        function filterCheckin(filter) {
            checkinFilter = filter;
            const buttons = document.querySelectorAll('#checkin .bracket-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            updateCheckinList();
        }

        async function checkInDancer(id) {
            if (!isAdmin) return alert('Admin access required');
            await updateDancer(id, { checkedIn: true });
            showSyncStatus('‚úÖ Dancer checked in!');
        }

        async function uncheckInDancer(id) {
            if (!isAdmin) return alert('Admin access required');
            await updateDancer(id, { checkedIn: false });
            showSyncStatus('‚úÖ Check-in removed!');
        }

        async function markAsPaid(id) {
            if (!isAdmin) return alert('Admin access required');
            await updateDancer(id, { paid: true });
            showSyncStatus('üí∞ Marked as paid!');
        }

        async function markAsUnpaid(id) {
            if (!isAdmin) return alert('Admin access required');
            await updateDancer(id, { paid: false });
            showSyncStatus('üí≥ Marked as unpaid!');
        }


        // Bracket Generation
        document.getElementById('generateBracketsBtn').addEventListener('click', generateBrackets);

        async function generateBrackets() {
            if (!isAdmin) return alert('Admin access required');

            const dancersArray = Object.values(dancers);
            const checkedInDancers = dancersArray.filter(d => d.checkedIn && d.type === 'participant');
            
            if (checkedInDancers.length === 0) {
                return alert('‚ö†Ô∏è No dancers have checked in yet!');
            }
            
            brackets = {};
            const ageBrackets = ['6-8', '9-11', '12-14', '15-18'];
            
            ageBrackets.forEach(bracket => {
                const bracketDancers = checkedInDancers.filter(d => d.ageBracket === bracket);
                if (bracketDancers.length > 0) {
                    const shuffled = bracketDancers.sort(() => Math.random() - 0.5);
                    brackets[bracket] = createBracket(shuffled);
                }
            });
            
            await saveBrackets();
            displayBracketSelector();
            displayPublicBracketSelector();
            alert('üî• All brackets generated successfully!');
        }

        function regenerateBracket(ageBracket) {
            if (!isAdmin) return alert('Admin access required');
            
            const confirmed = confirm(`üîÑ Regenerate ${ageBracket} bracket?\n\nThis will:\n- Delete current bracket and all match results\n- Create a new randomized bracket with the same dancers\n\nContinue?`);
            
            if (!confirmed) return;
            
            const dancersArray = Object.values(dancers);
            const checkedInDancers = dancersArray.filter(d => d.checkedIn && d.type === 'participant' && d.ageBracket === ageBracket);
            
            if (checkedInDancers.length === 0) {
                alert(`‚ö†Ô∏è No checked-in dancers found in ${ageBracket} bracket!`);
                return;
            }
            
            const shuffled = checkedInDancers.sort(() => Math.random() - 0.5);
            brackets[ageBracket] = createBracket(shuffled);
            
            saveBrackets();
            displayBracketSelector();
            displayPublicBracketSelector();
            showSyncStatus(`üîÑ ${ageBracket} bracket regenerated!`);
        }

        function resetSingleBracket(ageBracket) {
            if (!isAdmin) return alert('Admin access required');
            
            const confirmed = confirm(`‚ö†Ô∏è Reset ${ageBracket} bracket?\n\nThis will permanently delete:\n- The ${ageBracket} bracket\n- All match results\n- All winner selections\n\nThis action cannot be undone!\n\nContinue?`);
            
            if (!confirmed) return;
            
            delete brackets[ageBracket];
            saveBrackets();
            displayBracketSelector();
            displayPublicBracketSelector();
            showSyncStatus(`üóëÔ∏è ${ageBracket} bracket reset!`);
            alert(`‚úÖ ${ageBracket} bracket has been reset.`);
        }

        function toggleManualEntry() {
            const section = document.getElementById('manualEntrySection');
            const btn = document.getElementById('toggleManualEntryBtn');
            
            if (section.style.display === 'none' || section.style.display === '') {
                section.style.display = 'block';
                btn.style.display = 'none';
                populateManualBracketSelect();
            } else {
                section.style.display = 'none';
                btn.style.display = 'inline-block';
                // Clear form
                document.getElementById('manualDancerName').value = '';
            }
        }

        function populateManualBracketSelect() {
            const select = document.getElementById('manualBracketSelect');
            const availableBrackets = Object.keys(brackets);
            
            select.innerHTML = '<option value="">Choose bracket...</option>' +
                availableBrackets.map(b => `<option value="${b}">${b} Years</option>`).join('');
        }

        function updateManualRoundSelect() {
            const bracketSelect = document.getElementById('manualBracketSelect');
            const roundSelect = document.getElementById('manualRoundSelect');
            const ageBracket = bracketSelect.value;
            
            if (!ageBracket) {
                roundSelect.innerHTML = '<option value="">Choose round...</option>';
                return;
            }
            
            const bracketData = brackets[ageBracket];
            const totalRounds = bracketData.length;
            
            roundSelect.innerHTML = '<option value="">Choose round...</option>' +
                bracketData.map((round, idx) => 
                    `<option value="${idx}">${getRoundName(idx, totalRounds)}</option>`
                ).join('');
        }

        function updateManualMatchSelect() {
            const bracketSelect = document.getElementById('manualBracketSelect');
            const roundSelect = document.getElementById('manualRoundSelect');
            const matchSelect = document.getElementById('manualMatchSelect');
            
            const ageBracket = bracketSelect.value;
            const roundIndex = roundSelect.value;
            
            if (!ageBracket || roundIndex === '') {
                matchSelect.innerHTML = '<option value="">Choose match...</option>';
                return;
            }
            
            const round = brackets[ageBracket][parseInt(roundIndex)];
            
            matchSelect.innerHTML = '<option value="">Choose match...</option>' +
                round.map((match, idx) => {
                    const comp1 = match.competitor1?.name || 'Empty';
                    const comp2 = match.competitor2?.name || 'Empty';
                    return `<option value="${idx}">Battle ${idx + 1}: ${comp1} vs ${comp2}</option>`;
                }).join('');
        }

        function addManualDancer() {
            if (!isAdmin) return alert('Admin access required');
            
            const ageBracket = document.getElementById('manualBracketSelect').value;
            const roundIndex = parseInt(document.getElementById('manualRoundSelect').value);
            const matchIndex = parseInt(document.getElementById('manualMatchSelect').value);
            const position = parseInt(document.getElementById('manualPosition').value);
            const dancerName = document.getElementById('manualDancerName').value.trim();
            
            if (!ageBracket || isNaN(roundIndex) || isNaN(matchIndex) || !dancerName) {
                return alert('‚ö†Ô∏è Please fill in all fields!');
            }
            
            const match = brackets[ageBracket][roundIndex][matchIndex];
            
            // Create manual dancer object
            const manualDancer = {
                id: `manual-${Date.now()}`,
                name: dancerName,
                position: 999 // Special marker for manual entries
            };
            
            // Add to the specified position
            if (position === 1) {
                match.competitor1 = manualDancer;
            } else {
                match.competitor2 = manualDancer;
            }
            
            // Clear winner if exists (match needs to be re-fought)
            match.winner = null;
            
            // Save
            saveBrackets();
            
            // Update display
            displayBracket(ageBracket, true);
            displayPublicBracketSelector();
            
            showSyncStatus(`‚úÖ ${dancerName} added to bracket!`);
            alert(`‚úÖ ${dancerName} has been added to the bracket!\n\nBattle ${matchIndex + 1}, Position ${position === 1 ? 'Top' : 'Bottom'}`);
            
            // Reset form
            toggleManualEntry();
        }

        function resetAllBrackets() {
            if (!isAdmin) return alert('Admin access required');
            
            const confirmed = confirm('‚ö†Ô∏è RESET ALL BRACKETS?\n\nThis will delete:\n- ALL age brackets (6-8, 9-11, 12-14, 15-18)\n- ALL match results\n- ALL winner selections\n\nThis action cannot be undone!');
            
            if (!confirmed) return;
            
            // Double confirmation for safety
            const doubleConfirm = confirm('üö® FINAL WARNING üö®\n\nYou are about to permanently delete ALL tournament data.\n\nAre you ABSOLUTELY SURE?');
            
            if (!doubleConfirm) return;
            
            brackets = {};
            saveBrackets();
            displayBracketSelector();
            displayPublicBracketSelector();
            showSyncStatus('üóëÔ∏è All brackets reset!');
            alert('‚úÖ All brackets have been reset. You can now generate new brackets.');
        }

        function createBracket(dancers) {
            const rounds = [];
            
            console.log(`Creating bracket for ${dancers.length} dancers`);
            
            // Shuffle dancers randomly for fairness
            const shuffled = [...dancers].sort(() => Math.random() - 0.5);
            
            // ONLY create the first round - subsequent rounds created after battles complete
            const initialMatchups = [];
            for (let i = 0; i < shuffled.length; i += 2) {
                if (i + 1 < shuffled.length) {
                    // Two dancers battle
                    initialMatchups.push({
                        id: `round1-match-${i/2}`,
                        competitor1: {
                            id: shuffled[i].id,
                            name: shuffled[i].name,
                            position: i
                        },
                        competitor2: {
                            id: shuffled[i + 1].id,
                            name: shuffled[i + 1].name,
                            position: i + 1
                        },
                        winner: null
                    });
                } else {
                    // Odd dancer gets a bye in first round only
                    initialMatchups.push({
                        id: `round1-match-${i/2}`,
                        competitor1: {
                            id: shuffled[i].id,
                            name: shuffled[i].name,
                            position: i
                        },
                        competitor2: null,
                        winner: {
                            id: shuffled[i].id,
                            name: shuffled[i].name,
                            position: i
                        }
                    });
                }
            }
            
            rounds.push(initialMatchups);
            console.log(`Round 1: ${initialMatchups.length} matches created`);
            console.log(`Total rounds created: ${rounds.length} (more will be generated as battles complete)`);
            
            return rounds;
        }

        // Check if all matches in a round are complete
        function isRoundComplete(bracket, roundIndex) {
            const round = bracket[roundIndex];
            return round.every(match => match.winner !== null && match.winner !== undefined);
        }

        // Generate the next round from winners of current round
        function generateNextRound(bracket, currentRoundIndex) {
            const currentRound = bracket[currentRoundIndex];
            
            // Get all winners from current round
            const winners = currentRound
                .map(match => match.winner)
                .filter(winner => winner !== null && winner !== undefined);
            
            console.log(`Generating next round from ${winners.length} winners`);
            
            if (winners.length <= 1) {
                console.log('Tournament complete!');
                return; // Tournament is over
            }
            
            // Randomly shuffle winners for fairness (prevent same matchups, spread byes)
            const shuffledWinners = [...winners].sort(() => Math.random() - 0.5);
            
            // Create matches for next round
            const nextRound = [];
            for (let i = 0; i < shuffledWinners.length; i += 2) {
                if (i + 1 < shuffledWinners.length) {
                    // Two winners battle - ensure all properties are explicitly set
                    nextRound.push({
                        id: `round${currentRoundIndex + 2}-match-${i/2}`,
                        competitor1: {
                            id: shuffledWinners[i].id,
                            name: shuffledWinners[i].name,
                            position: shuffledWinners[i].position || 0
                        },
                        competitor2: {
                            id: shuffledWinners[i + 1].id,
                            name: shuffledWinners[i + 1].name,
                            position: shuffledWinners[i + 1].position || 0
                        },
                        winner: null
                    });
                } else {
                    // Odd winner gets a bye - explicitly set competitor2 to null
                    nextRound.push({
                        id: `round${currentRoundIndex + 2}-match-${i/2}`,
                        competitor1: {
                            id: shuffledWinners[i].id,
                            name: shuffledWinners[i].name,
                            position: shuffledWinners[i].position || 0
                        },
                        competitor2: null,
                        winner: {
                            id: shuffledWinners[i].id,
                            name: shuffledWinners[i].name,
                            position: shuffledWinners[i].position || 0
                        }
                    });
                }
            }
            
            console.log(`Round ${currentRoundIndex + 2}: ${nextRound.length} matches created`);
            bracket.push(nextRound);
        }

        // Helper function to get round name based on number of rounds total and current round
        function getRoundName(roundIndex, totalRounds) {
            const roundsFromEnd = totalRounds - roundIndex - 1;
            
            // Name rounds from the end backwards
            if (roundsFromEnd === 0) return 'Finals';
            if (roundsFromEnd === 1) return 'Semi Finals';
            if (roundsFromEnd === 2) return 'Quarter Finals';
            if (roundsFromEnd === 3) return 'Round of 16';
            if (roundsFromEnd === 4) return 'Round of 32';
            if (roundsFromEnd === 5) return 'Round of 64';
            
            // For earlier rounds, just use round number
            return `Round ${roundIndex + 1}`;
        }

        function displayBracketSelector() {
            const selector = document.getElementById('bracketSelector');
            const availableBrackets = Object.keys(brackets);
            const manualEntryBtn = document.getElementById('toggleManualEntryBtn');
            
            if (availableBrackets.length === 0) {
                selector.innerHTML = '<p style="text-align: center; color: var(--electric-blue); font-size: 1.2rem;">Generate brackets first!</p>';
                document.getElementById('bracketDisplay').innerHTML = '';
                if (manualEntryBtn) manualEntryBtn.style.display = 'none';
                return;
            }
            
            // Show manual entry button when brackets exist
            if (manualEntryBtn) manualEntryBtn.style.display = 'inline-block';
            
            selector.innerHTML = `
                <div style="width: 100%;">
                    ${availableBrackets.map(bracket => `
                        <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap;">
                            <button class="bracket-btn" onclick="displayBracket('${bracket}', true)">${bracket} Years</button>
                            <button class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.9rem;" onclick="regenerateBracket('${bracket}')">
                                üîÑ Regenerate
                            </button>
                            <button class="btn" style="padding: 0.5rem 1rem; font-size: 0.9rem; background: linear-gradient(135deg, #e67e22, #d35400); border-color: #e67e22;" onclick="resetSingleBracket('${bracket}')">
                                üóëÔ∏è Reset
                            </button>
                        </div>
                    `).join('')}
                </div>
            `;
            
            displayBracket(availableBrackets[0], true);
        }

        function displayPublicBracketSelector() {
            const selector = document.getElementById('publicBracketSelector');
            const availableBrackets = Object.keys(brackets);
            
            if (availableBrackets.length === 0) {
                selector.innerHTML = '<p style="text-align: center; color: var(--electric-blue); font-size: 1.2rem;">Brackets will appear here once generated!</p>';
                document.getElementById('publicBracketDisplay').innerHTML = '';
                return;
            }
            
            selector.innerHTML = availableBrackets.map(bracket => `
                <button class="bracket-btn" onclick="displayBracket('${bracket}', false)">${bracket} Years</button>
            `).join('');
            
            displayBracket(availableBrackets[0], false);
        }

        function displayBracket(ageBracket, canEdit) {
            const displayId = canEdit ? 'bracketDisplay' : 'publicBracketDisplay';
            const selectorId = canEdit ? 'bracketSelector' : 'publicBracketSelector';
            
            document.querySelectorAll(`#${selectorId} .bracket-btn`).forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.includes(ageBracket)) btn.classList.add('active');
            });
            
            const bracketData = brackets[ageBracket];
            const display = document.getElementById(displayId);
            
            if (!bracketData || bracketData.length === 0) {
                display.innerHTML = '<p style="text-align: center; color: var(--electric-blue); font-size: 1.2rem;">No bracket data available.</p>';
                return;
            }
            
            const finalRound = bracketData[bracketData.length - 1];
            
            // Only show champion if:
            // 1. Final round exists
            // 2. Final round has exactly 1 match (it's the actual Finals)
            // 3. That match has TWO competitors (not a bye)
            // 4. That match has a winner
            let champion = null;
            if (finalRound && 
                finalRound.length === 1 && 
                finalRound[0].competitor1 && 
                finalRound[0].competitor2 && 
                finalRound[0].winner) {
                champion = finalRound[0].winner;
            }
            
            let html = '';
            
            if (champion) {
                html += `
                    <div class="champion-banner">
                        <h2>üèÜ CHAMPION üèÜ</h2>
                        <p>${champion.name}</p>
                    </div>
                `;
            }
            
            const totalRounds = bracketData.length;
            
            bracketData.forEach((round, roundIndex) => {
                if (round.length === 0) return;
                
                const roundName = getRoundName(roundIndex, totalRounds);
                
                html += `
                    <div class="bracket-container">
                        <h3 class="round-title">${roundName} (${round.length} ${round.length === 1 ? 'Battle' : 'Battles'})</h3>
                        <div class="matchups">
                            ${round.map((match, matchIndex) => {
                                if (!match.competitor1) return '';
                                
                                return `
                                    <div class="matchup">
                                        <div class="matchup-header">Battle ${matchIndex + 1}</div>
                                        <div class="competitor ${match.winner && match.winner.id === match.competitor1.id ? 'winner' : ''}">
                                            <span>${match.competitor1.name}</span>
                                            ${canEdit && !match.winner && match.competitor2 ? `
                                                <button class="select-winner" onclick="selectWinner('${ageBracket}', ${roundIndex}, ${matchIndex}, 1)">
                                                    Select Winner
                                                </button>
                                            ` : ''}
                                        </div>
                                        ${match.competitor2 ? `
                                            <div class="competitor ${match.winner && match.winner.id === match.competitor2.id ? 'winner' : ''}">
                                                <span>${match.competitor2.name}</span>
                                                ${canEdit && !match.winner ? `
                                                    <button class="select-winner" onclick="selectWinner('${ageBracket}', ${roundIndex}, ${matchIndex}, 2)">
                                                        Select Winner
                                                    </button>
                                                ` : ''}
                                            </div>
                                        ` : '<div style="text-align: center; color: var(--gold); font-style: italic;">Bye - Auto Advance</div>'}
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            });
            
            display.innerHTML = html;
        }

        function selectWinner(ageBracket, roundIndex, matchIndex, competitorNum) {
            if (!isAdmin) return alert('Admin access required');

            const bracket = brackets[ageBracket];
            const match = bracket[roundIndex][matchIndex];
            const winner = competitorNum === 1 ? match.competitor1 : match.competitor2;
            
            console.log('Selecting winner:', winner, 'from match:', match);
            
            // Mark the winner in current match
            match.winner = winner;
            
            // Check if this round is now complete (all matches have winners)
            if (isRoundComplete(bracket, roundIndex)) {
                console.log(`Round ${roundIndex + 1} is complete!`);
                
                // Check if we need to generate the next round
                if (roundIndex + 1 >= bracket.length) {
                    console.log('Generating next round...');
                    generateNextRound(bracket, roundIndex);
                } else {
                    console.log('Next round already exists');
                }
            } else {
                console.log(`Round ${roundIndex + 1} not complete yet - waiting for more battles`);
            }
            
            // Save to Firebase
            saveBrackets();
            
            // Refresh displays
            displayBracket(ageBracket, true);
            displayPublicBracketSelector();
            
            console.log('Updated bracket:', bracket);
        }

        // Dashboard
        function updateDashboard() {
            // Convert Firebase object to array
            const dancersArray = Object.values(dancers);
            
            const totalDancers = dancersArray.filter(d => d.type === 'participant').length;
            const checkedIn = dancersArray.filter(d => d.checkedIn && d.type === 'participant').length;
            const totalPaid = dancersArray.filter(d => d.paid).length;
            const totalUnpaid = dancersArray.length - totalPaid;
            
            const revenue = totalPaid * 15; // All dancers pay $15
            
            const bracketCounts = {
                '6-8': dancersArray.filter(d => d.ageBracket === '6-8' && d.type === 'participant').length,
                '9-11': dancersArray.filter(d => d.ageBracket === '9-11' && d.type === 'participant').length,
                '12-14': dancersArray.filter(d => d.ageBracket === '12-14' && d.type === 'participant').length,
                '15-18': dancersArray.filter(d => d.ageBracket === '15-18' && d.type === 'participant').length
            };
            
            document.getElementById('statsGrid').innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${totalDancers}</div>
                    <div class="stat-label">Total Dancers</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${checkedIn}</div>
                    <div class="stat-label">Checked In</div>
                </div>
                <div class="stat-card" style="border-color: var(--neon-green);">
                    <div class="stat-number">${totalPaid}</div>
                    <div class="stat-label">Paid</div>
                </div>
                <div class="stat-card" style="border-color: var(--flame-orange);">
                    <div class="stat-number">${totalUnpaid}</div>
                    <div class="stat-label">Unpaid</div>
                </div>
                <div class="stat-card" style="border-color: var(--gold);">
                    <div class="stat-number">$${revenue}</div>
                    <div class="stat-label">Revenue Collected</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${bracketCounts['6-8']}</div>
                    <div class="stat-label">Ages 6-8</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${bracketCounts['9-11']}</div>
                    <div class="stat-label">Ages 9-11</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${bracketCounts['12-14']}</div>
                    <div class="stat-label">Ages 12-14</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${bracketCounts['15-18']}</div>
                    <div class="stat-label">Ages 15-18</div>
                </div>
            `;
            
            const allDancers = dancersArray.filter(d => d.type === 'participant');
            document.getElementById('allDancersList').innerHTML = allDancers.length > 0 ? allDancers.map(dancer => `
                <div class="dancer-card">
                    <div class="dancer-name">${dancer.name}</div>
                    <div class="dancer-info">Age: ${dancer.age}</div>
                    <div class="dancer-info">Bracket: ${dancer.ageBracket}</div>
                    <div style="margin-top: 0.5rem;">
                        <span class="${dancer.checkedIn ? 'checked-in' : 'not-checked-in'}">
                            ${dancer.checkedIn ? '‚úì Checked In' : 'Not Checked In'}
                        </span>
                        <span class="${dancer.paid ? 'checked-in' : 'not-checked-in'}" style="margin-left: 0.5rem;">
                            ${dancer.paid ? 'üí∞ Paid' : 'üí≥ Unpaid'}
                        </span>
                    </div>
                </div>
            `).join('') : '<p style="text-align: center; color: var(--electric-blue); font-size: 1.2rem;">No dancers registered yet.</p>';
        }

        // Initialize
        window.addEventListener('load', () => {
            updateUIForAdminStatus();
            updateLoginButton();
            // Firebase listeners automatically load data - no manual load needed!
            console.log('üî• Site initialized - Firebase real-time sync active');
        });
    </script>
</body>
</html>
